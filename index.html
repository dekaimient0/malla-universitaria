<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Malla Interactiva Completa</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
      background: #f7f7f7;
    }
    h2 {
      margin-top: 40px;
    }
    .semester {
      margin-bottom: 20px;
    }
    .course {
      padding: 10px;
      margin: 5px;
      display: inline-block;
      background: #e0e0e0;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      max-width: 220px;
      text-align: center;
      user-select: none;
    }
    .course.approved {
      background-color: #81c784;
      text-decoration: line-through;
      color: #1b5e20;
      font-weight: bold;
    }
    .course.locked {
      background-color: #bdbdbd;
      cursor: not-allowed;
      color: #757575;
    }
  </style>
</head>
<body>
  <h1>Malla Interactiva Completa</h1>

  <div id="malla"></div>

  <script>
    const malla = {
      "I Semestre": [
        { nombre: "Sociedad y Profesión I" },
        { nombre: "Física I" },
        { nombre: "Anatomía" },
        { nombre: "Química General y Orgánica" },
        { nombre: "Biología Celular y Molecular" },
        { nombre: "Matemática I" },
      ],
      "II Semestre": [
        { nombre: "Sociedad y Profesión II" },
        { nombre: "Física II", prerequisitos: ["Física I", "Matemática I"] },
        { nombre: "Fisiología I", prerequisitos: ["Física I", "Química General y Orgánica"] },
        { nombre: "Bioquímica", prerequisitos: ["Química General y Orgánica"] },
        { nombre: "Genética" },
        { nombre: "Histología y Embriología" },
        { nombre: "Matemática II", prerequisitos: ["Matemática I"] },
      ],
      "III Semestre": [
        { nombre: "Sociedad y Profesión III" },
        { nombre: "Agentes Vivos de la Enfermedad", prerequisitos: ["Biología Celular y Molecular", "Bioquímica"] },
        { nombre: "Fisiología II", prerequisitos: ["Fisiología I"] },
        { nombre: "Inmunología", prerequisitos: ["Bioquímica", "Genética"] },
        { nombre: "Bioquímica Aplicada", prerequisitos: [
          "Sociedad y Profesión I", "Anatomía", "Biología Celular y Molecular", "Física I", "Química General y Orgánica", "Matemática I",
          "Sociedad y Profesión II", "Bioquímica", "Física II", "Genética", "Histología y Embriología", "Matemática II", "Fisiología I"
        ]},
      ],
      "IV Semestre": [
        { nombre: "Profesión, Persona y Sociedad" },
        { nombre: "Salud Pública", prerequisitos: ["Sociedad y Profesión III"] },
        { nombre: "Fisiopatología", prerequisitos: ["Bioquímica", "Fisiología II"] },
        { nombre: "Farmacología", prerequisitos: ["Bioquímica"] },
        { nombre: "Tecnologías Moleculares Aplicadas al Diagnóstico", prerequisitos: ["Bioquímica Aplicada"] },
      ],
      "V Semestre": [
        { nombre: "Estadística y Epidemiología", prerequisitos: ["Salud Pública"] },
        { nombre: "Módulo Integrado Interdisciplinario Multiprofesional I" },
        { nombre: "Parasitología", prerequisitos: ["Agentes Vivos de la Enfermedad"] },
        { nombre: "Química Clínica", prerequisitos: ["Fisiopatología", "Bioquímica Aplicada"] },
      ],
      "VI Semestre": [
        { nombre: "Intervención Comunitaria I", prerequisitos: ["Profesión, Persona y Sociedad"] },
        { nombre: "Gestión I", prerequisitos: ["Estadística y Epidemiología"] },
        { nombre: "Microbiología Clínica", prerequisitos: ["Agentes Vivos de la Enfermedad"] },
      ],
      "VII Semestre": [
        { nombre: "Intervención Comunitaria II", prerequisitos: ["Intervención Comunitaria I"] },
        { nombre: "Metodologías de la Investigación", prerequisitos: ["Metodologías de la Investigación"] }, // Parece prereq propio, cuidado
        { nombre: "Gestión II", prerequisitos: ["Gestión I"] },
        { nombre: "Aseguramiento de la Calidad en el Laboratorio", prerequisitos: ["Química Clínica"] },
        { nombre: "Hematología", prerequisitos: ["Fisiopatología"] },
      ],
      "VIII Semestre": [
        { nombre: "Proyecto de Investigación", prerequisitos: ["Metodologías de la Investigación"] },
        { nombre: "Módulo Integrado Interdisciplinario Multiprofesional II", prerequisitos: ["Módulo Integrado Interdisciplinario Multiprofesional I"] },
        { nombre: "Integración Interdisciplinaria en el Diagnóstico del Laboratorio de Bioanálisis", prerequisitos: ["Química Clínica", "Microbiología Clínica", "Parasitología", "Hematología"] },
        { nombre: "Medicina Transfusional", prerequisitos: ["Hematología"] },
      ],
      "IX Semestre": [
        { nombre: "Trabajo de Investigación", prerequisitos: ["Proyecto de Investigación"] },
        { nombre: "Gestión de la Calidad", prerequisitos: ["Gestión II"] },
        { nombre: "Práctica Profesional", prerequisitos: [
          "Aseguramiento de la Calidad en el Laboratorio", "Gestión II", "Intervención Comunitaria II", 
          "Proyecto de Investigación", "Integración Interdisciplinaria en el Diagnóstico del Laboratorio de Bioanálisis",
          "Medicina Transfusional", "Módulo Integrado Interdisciplinario Multiprofesional II"
        ] },
      ],
      "X Semestre": [
        { nombre: "Trabajo de Investigación", prerequisitos: ["Proyecto de Investigación"] },
        { nombre: "Gestión de la Calidad", prerequisitos: ["Gestión II"] },
        { nombre: "Práctica Profesional", prerequisitos: [
          "Aseguramiento de la Calidad en el Laboratorio", "Gestión II", "Intervención Comunitaria II", 
          "Proyecto de Investigación", "Integración Interdisciplinaria en el Diagnóstico del Laboratorio de Bioanálisis",
          "Medicina Transfusional", "Módulo Integrado Interdisciplinario Multiprofesional II"
        ] },
      ],
    };

    const progreso = JSON.parse(localStorage.getItem("mallaProgreso") || "[]");

    function estaDisponible(ramo) {
      if (!ramo.prerequisitos) return true;
      return ramo.prerequisitos.every(pr => progreso.includes(pr));
    }

    function crearMalla() {
      const contenedor = document.getElementById("malla");
      contenedor.innerHTML = "";

      for (const [semestre, ramos] of Object.entries(malla)) {
        const divSemestre = document.createElement("div");
        divSemestre.className = "semester";
        const h2 = document.createElement("h2");
        h2.textContent = semestre;
        divSemestre.appendChild(h2);

        ramos.forEach(ramo => {
          const divRamo = document.createElement("div");
          divRamo.textContent = ramo.nombre;
          divRamo.className = "course";

          const aprobado = progreso.includes(ramo.nombre);
          const disponible = estaDisponible(ramo);

          if (aprobado) divRamo.classList.add("approved");
          else if (!disponible) divRamo.classList.add("locked");

          divRamo.onclick = () => {
            if (!estaDisponible(ramo)) return;

            if (progreso.includes(ramo.nombre)) {
              const idx = progreso.indexOf(ramo.nombre);
              progreso.splice(idx, 1);
            } else {
              progreso.push(ramo.nombre);
            }
            localStorage.setItem("mallaProgreso", JSON.stringify(progreso));
            crearMalla();
          };

          divSemestre.appendChild(divRamo);
        });

        contenedor.appendChild(divSemestre);
      }
    }

    crearMalla();
  </script>
</body>
</html>
